<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../architecture_and_requirements/">
      
      
        <link rel="next" href="../detailed_deployment_local/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Cluster Deployment - IBM Geospatial Exploration and Orchestration Studio</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#geospatial-studio-deployment-instructions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="IBM Geospatial Exploration and Orchestration Studio" class="md-header__button md-logo" aria-label="IBM Geospatial Exploration and Orchestration Studio" data-md-component="logo">
      
  <img src="../assets/geospatial-studio-logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            IBM Geospatial Exploration and Orchestration Studio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cluster Deployment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-schema: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IBM Geospatial Exploration and Orchestration Studio" class="md-nav__button md-logo" aria-label="IBM Geospatial Exploration and Orchestration Studio" data-md-component="logo">
      
  <img src="../assets/geospatial-studio-logo-white.svg" alt="logo">

    </a>
    IBM Geospatial Exploration and Orchestration Studio
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started-UI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started with the UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started-SDK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started with the SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    User guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sample-payloads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sample payloads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sample-files/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sample files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4">
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Studio UI user guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Studio UI user guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inference-lab/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inferencing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset-factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fine-tuning dataset factory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tuning-studio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fine-tuning studio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../walkthroughs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI walkthroughs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API specification
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inference-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inference Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataset-factory-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fine-tuning Dataset Factory
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fine-tuning-service/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fine-tuning Service
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Deployment and architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Deployment and architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture_and_requirements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architechture and Dependencies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Cluster Deployment
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Cluster Deployment
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Cluster configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Cluster configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-deployment-namespace-admin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create deployment namespace [Admin]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-deployer-role-for-project-admin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Deployer role for project [Admin]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-gpu-drivers-adminopenshift" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install GPU drivers [Admin][OpenShift]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install GPU drivers [Admin][OpenShift]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-verify-or-install-operators-and-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Verify or install operators and plugins
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-s3-compatible-cloud-object-storage-drivers-for-openshift-admin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing S3 compatible cloud object storage drivers for OpenShift [Admin]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing S3 compatible cloud object storage drivers for OpenShift [Admin]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ibm-cloud-object-storage-plug-in" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. IBM Cloud Object Storage plug-in
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-initialize-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Initialize environment variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-storage-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Storage setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Storage setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-s3-compatible-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set up S3 compatible storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-s3-compatible-storage_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set up S3 compatible storage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Set up S3 compatible storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minio" class="md-nav__link">
    <span class="md-ellipsis">
      
        MinIO
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-required-buckets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create the required buckets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populate-buckets-with-initial-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Populate buckets with initial data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-database-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Database preparation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Database preparation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-postgresql-instance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set up Postgresql instance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Set up Postgresql instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-a-postgresql-database-instance-in-ibm-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up a Postgresql database instance in IBM Cloud
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-a-postgresql-database-instance-in-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up a Postgresql database instance in cluster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create databases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-authenticator-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Authenticator setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Authenticator setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-and-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing and setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing and setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ibm-security-verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. IBM Security Verify
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-keycloak" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Keycloak
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-keycloak-realm-and-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure Keycloak Realm and Client
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-geoserver-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Geoserver setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-external-services-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. External services configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. External services configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-mapbox" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Mapbox
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cesium" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Cesium
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-sentinel-hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Sentinel Hub
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-nasa-earth-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Nasa Earth Data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-extra-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Extra configuration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../detailed_deployment_local/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-cluster-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Cluster configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Cluster configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-deployment-namespace-admin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create deployment namespace [Admin]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-deployer-role-for-project-admin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create Deployer role for project [Admin]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-gpu-drivers-adminopenshift" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install GPU drivers [Admin][OpenShift]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install GPU drivers [Admin][OpenShift]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-verify-or-install-operators-and-plugins" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Verify or install operators and plugins
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-s3-compatible-cloud-object-storage-drivers-for-openshift-admin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing S3 compatible cloud object storage drivers for OpenShift [Admin]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing S3 compatible cloud object storage drivers for OpenShift [Admin]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ibm-cloud-object-storage-plug-in" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. IBM Cloud Object Storage plug-in
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-initialize-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Initialize environment variables
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-storage-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Storage setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Storage setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-s3-compatible-storage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set up S3 compatible storage
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-s3-compatible-storage_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set up S3 compatible storage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Set up S3 compatible storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minio" class="md-nav__link">
    <span class="md-ellipsis">
      
        MinIO
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-required-buckets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create the required buckets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#populate-buckets-with-initial-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Populate buckets with initial data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-database-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Database preparation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Database preparation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-up-postgresql-instance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set up Postgresql instance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Set up Postgresql instance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setting-up-a-postgresql-database-instance-in-ibm-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up a Postgresql database instance in IBM Cloud
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-a-postgresql-database-instance-in-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting up a Postgresql database instance in cluster
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-databases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create databases
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-authenticator-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Authenticator setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Authenticator setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installing-and-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Installing and setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing and setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ibm-security-verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. IBM Security Verify
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-keycloak" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Keycloak
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-keycloak-realm-and-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure Keycloak Realm and Client
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-geoserver-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Geoserver setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-external-services-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. External services configuration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. External services configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-mapbox" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Mapbox
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-cesium" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Cesium
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-sentinel-hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Sentinel Hub
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-nasa-earth-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Nasa Earth Data
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-extra-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Extra configuration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<div><h1 id="geospatial-studio-deployment-instructions">Geospatial Studio - Deployment instructions</h1>
<blockquote>
<p>Note: Strictly run all the scripts in this guide from the root directory of the <a href="https://github.com/terrastackai/geospatial-studio">geospatial-studio repository</a>.</p>
</blockquote>
<p><strong>Deployment steps:</strong></p>
<ol>
<li><a href="#1-cluster-configuration">Cluster configuration</a></li>
<li><a href="#2-initialize-environment-variables">Initialize environment variables</a></li>
<li><a href="#3-storage-setup">Create and configure COS instance and buckets</a></li>
<li><a href="#4-database-preparation">Create and configure DBs + tables</a></li>
<li><a href="#5-authenticator-setup">Setup authenticator</a></li>
<li><a href="#6-geoserver-setup">Geoserver setup</a></li>
<li><a href="#7-external-services-configuration">External services (Optional)</a></li>
<li><a href="#8-extra-configuration">Extra configuration</a></li>
<li><a href="#9-deploy-geospatial-studio-services">Deploy Geospatial Studio services</a></li>
<li><a href="#10-testing">End-to-end tests</a></li>
</ol>
<h2 id="1-cluster-configuration">1. Cluster configuration</h2>
<h3 id="initialization">Initialization</h3>
<p>Provide a name for the deployment environment, maybe cluster name e.g. fmaas-dev, cimf-staging, rosa-prod, local... This will be the name used for a local folder created under workspace directory.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DEPLOYMENT_ENV</span><span class="o">=</span>xxxx
</code></pre></div>
<p>Set up the kubectl context or login to openshift:
For OpenShift use the script below to login after supplying the token and server. These can be obtained from OpenShift console.
</p><div class="highlight"><pre><span></span><code>oc<span class="w"> </span>login<span class="w"> </span>--token<span class="o">=</span>&lt;cluster-token&gt;<span class="w"> </span>--server<span class="o">=</span>&lt;cluster-server&gt;
</code></pre></div>
<p>Set cluster namespace/project as an environment variable OC_PROJECT
</p><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">OC_PROJECT</span><span class="o">=</span>xxxx
</code></pre></div>
<h3 id="create-deployment-namespace-admin">Create deployment namespace [Admin]</h3>
<div class="highlight"><pre><span></span><code>./deployment-scripts/create-namespace.sh
</code></pre></div>
<h3 id="create-deployer-role-for-project-admin">Create Deployer role for project [Admin]</h3>
<p>Non-administrator users require elevated privileges to deploy the Geospatial Studio stack.  </p>
<p>Run the following once per project/namespace:
</p><div class="highlight"><pre><span></span><code>./deployment-scripts/admin-role-for-namespace.sh
</code></pre></div>
<p>Run the following for each existing non admin user in your cluster that you want to give studio deployer role:
</p><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">USER_TO_ADD</span><span class="o">=</span>&lt;email<span class="w"> </span>address&gt;
./deployment-scripts/admin-role-for-user.sh
</code></pre></div>
<h3 id="install-gpu-drivers-adminopenshift">Install GPU drivers [Admin][OpenShift]</h3>
<p>These steps only need to be done once for the cluster</p>
<blockquote>
<p>Only users with cluster admin privileges can perform these steps.</p>
</blockquote>
<h4 id="1-verify-or-install-operators-and-plugins">1. Verify or install operators and plugins</h4>
<ul>
<li><em>NVIDIA GPU Operator</em> in <code>nvidia-gpu-operator</code> namespace, follow these instructions https://docs.nvidia.com/datacenter/cloud-native/openshift/24.9.0/install-gpu-ocp.html#</li>
<li><em>Node Feature Discovery</em> in <code>openshift-nfd</code> namespace, follow these instructions https://docs.nvidia.com/datacenter/cloud-native/openshift/24.9.0/install-nfd.html</li>
</ul>
<h3 id="installing-s3-compatible-cloud-object-storage-drivers-for-openshift-admin">Installing S3 compatible cloud object storage drivers for OpenShift [Admin]</h3>
<p>These steps only need to be done once for the cluster</p>
<blockquote>
<p>Only users with cluster admin privileges can perform these steps.</p>
</blockquote>
<h4 id="1-ibm-cloud-object-storage-plug-in">1. IBM Cloud Object Storage plug-in</h4>
<p>Follow these instructions: https://cloud.ibm.com/docs/openshift?topic=openshift-storage_cos_install to install <em>IBM Cloud Object Storage</em> in <code>ibm-object-s3fs</code> namespace.</p>
<p>This will provide storage classes that are S3 compatible and can connect to MinIO, AWS S3, IBM COS Object storage instances</p>
<h2 id="2-initialize-environment-variables">2. Initialize environment variables</h2>
<blockquote>
<p>Note:  If you are coming back to this step later, and you might be missing the environment variables exported in <a href="#initialization">initialization section</a>, ensure you re-export them again in your terminal.
</p><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">DEPLOYMENT_ENV</span><span class="o">=</span>xxxx
<span class="nb">export</span><span class="w"> </span><span class="nv">OC_PROJECT</span><span class="o">=</span>xxxx
</code></pre></div>
</blockquote>
<p>This step will create two env scripts under the workspace/${DEPLOYMENT_ENV}/env folder.  One script contains just the secret values template, and the other script contains all the other general Geospatial configuration.</p>
<div class="highlight"><pre><span></span><code>./deployment-scripts/setup-workspace-env.sh
</code></pre></div>
<p><strong><em>Note</em></strong> Work through each env var in <code>workspace/${DEPLOYMENT_ENV}/env</code> and poplulate environment variables as required at this time or as you generate them in the subsequent steps.</p>
<h2 id="3-storage-setup">3. Storage setup</h2>
<blockquote>
<p>Note:  Source latest environment variables using the command below..
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
</blockquote>
<h3 id="set-up-s3-compatible-storage">Set up S3 compatible storage</h3>
<p>The following storage options are supported:
- MinIO. A cluster-installed cloud object storage installation (Default)
- External cloud object storage service e.g. IBM Cloud Object Storage, AWS S3 etc</p>
<p>This section assumes you wish to use a cluster-installed instance of MinIO to provide S3-compatible object storage.</p>
<ul>
<li>Also at this point update <code>workspace/${DEPLOYMENT_ENV}/env/.env.sh</code> with...
  <div class="highlight"><pre><span></span><code><span class="c1"># Storage classes</span>
<span class="c1"># Verify the available storage classes in your cluster and set the following env vars</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">COS_STORAGE_CLASS</span><span class="o">=</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NON_COS_STORAGE_CLASS</span><span class="o">=</span>
</code></pre></div></li>
</ul>
<blockquote>
<p>Note:  Source the variables to export any newly added variables.
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/env/env.sh
</code></pre></div>
</blockquote>
<h3 id="set-up-s3-compatible-storage_1">Set up S3 compatible storage</h3>
<h4 id="minio">MinIO</h4>
<p>Deploy MinIO for S3-compatible object storage:
</p><div class="highlight"><pre><span></span><code><span class="c1"># Install MinIO</span>
python<span class="w"> </span>./deployment-scripts/update-deployment-template.py<span class="w"> </span>--disable-pvc<span class="w"> </span>--filename<span class="w"> </span>deployment-scripts/minio-deployment.yaml<span class="w"> </span>--storageclass<span class="w"> </span><span class="si">${</span><span class="nv">NON_COS_STORAGE_CLASS</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/initialisation/minio-deployment.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/initialisation/minio-deployment.yaml<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span>
kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready<span class="w"> </span>pod<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>minio<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>--timeout<span class="o">=</span>300s
<span class="nv">MINIO_API_URL</span><span class="o">=</span><span class="s2">"https://minio-api-</span><span class="nv">$OC_PROJECT</span><span class="s2">.</span><span class="nv">$CLUSTER_URL</span><span class="s2">"</span>

<span class="c1"># Update .env with the MinIO details for connection</span>
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/access_key_id=.*/access_key_id=minioadmin/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/secret_access_key=.*/secret_access_key=minioadmin/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s|endpoint=.*|endpoint=</span><span class="nv">$MINIO_API_URL</span><span class="s2">|g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/region=.*/region=us-east-1/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env
</code></pre></div>
<blockquote>
<p>Note:  This script should be run once only, if run before you should see the <code>deployment-scripts/.env</code> file</p>
</blockquote>
<ul>
<li>Once the S3 instance has been created and .env updated, you can validate the credentials and endpoint in the <code>workspace/${DEPLOYMENT_ENV}/env/.env</code></li>
</ul>
<h3 id="create-the-required-buckets">Create the required buckets</h3>
<p>Run the following script to create the buckets:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>deployment-scripts/create_buckets.py<span class="w"> </span>--env-path<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env
</code></pre></div>
<blockquote>
<p>NB: to update the list of buckets to create, currently you need to edit the list in the python script.</p>
</blockquote>
<h3 id="populate-buckets-with-initial-data">Populate buckets with initial data</h3>
<p>Run to populate the buckets with initial data (including the auxiliary data for post-processing)</p>
<div class="highlight"><pre><span></span><code>./deployment-scripts/populate-buckets-with-auxiliary-data.sh
</code></pre></div>
<p>To check the logs for the job populating the data to the buckets, you can run</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span>job/populate-buckets-job
</code></pre></div>
<blockquote>
<p>NB: this process might takes hours. You can continue with <a href="#4-database-preparation">database preparation</a>. You can also use the script below to check the contents of the ${BUCKET_INFERENCE_AUXDATA} bucket to ascertain completion. </p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/env/env.sh
python<span class="w"> </span>deployment-scripts/list_bucket_contents.py<span class="w"> </span>--env-path<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env<span class="w"> </span>--bkt<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">BUCKET_INFERENCE_AUXDATA</span><span class="si">}</span><span class="s2">"</span>
</code></pre></div>
<h2 id="4-database-preparation">4. Database preparation</h2>
<blockquote>
<p>Note:  Source latest environment variables using the command below..
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
</blockquote>
<h3 id="set-up-postgresql-instance">Set up Postgresql instance</h3>
<h4 id="setting-up-a-postgresql-database-instance-in-ibm-cloud">Setting up a Postgresql database instance in IBM Cloud</h4>
<p>Follow these instructions: https://cloud.ibm.com/docs/databases-for-postgresql?topic=databases-for-postgresql-getting-started&amp;interface=ui to provision an IBM Cloud Databases for PostgreSQL instance.</p>
<blockquote>
<p>Note: Ensure to allow public access to your database instance.</p>
</blockquote>
<ul>
<li>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  <div class="highlight"><pre><span></span><code><span class="nv">pg_username</span><span class="o">=</span>
<span class="nv">pg_password</span><span class="o">=</span>
<span class="nv">pg_uri</span><span class="o">=</span>
<span class="nv">pg_port</span><span class="o">=</span>
<span class="nv">pg_original_db_name</span><span class="o">=</span><span class="s1">'ibmclouddb'</span>
</code></pre></div></li>
</ul>
<h4 id="setting-up-a-postgresql-database-instance-in-cluster">Setting up a Postgresql database instance in cluster</h4>
<p>Add bitnami chart repository:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w">  </span>https://charts.bitnami.com/bitnami
helm<span class="w"> </span>repo<span class="w"> </span>update
</code></pre></div>
<p>Install postgres:</p>
<p><strong><em>Note</em></strong> If you have an instance of postgres already installed, following this guide to <a href="postgres-uninstall.md">uninstall</a>.</p>
<div class="highlight"><pre><span></span><code>./deployment-scripts/install-postgres.sh<span class="w"> </span>UPDATE_STORAGE<span class="w"> </span>DISABLE_PV<span class="w"> </span>DO_NOT_SET_SCC
</code></pre></div>
<p>Once completed, in terminal you will find some notes on the created postgres database. To prepare for the <a href="#create-databases">create databases</a> section below, follow these steps..
* To get the password for "postgres" run:
  </p><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>--namespace<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>postgresql<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.data.postgres-password}"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="k">)</span>
</code></pre></div>
<ul>
<li>To connect to your database from outside the cluster for <a href="#create-databases">create databases</a> section below execute the following commands:</li>
</ul>
<p><strong><em>Note</em></strong> change host port from default 54320 in the command below if the value of <code>pg_forwarded_port</code> was changed in <code>workspace/${DEPLOYMENT_ENV}/env/.env</code></p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>port-forward<span class="w"> </span>--namespace<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>svc/postgresql<span class="w"> </span><span class="m">54320</span>:5432<span class="w"> </span><span class="p">&amp;</span>
<span class="nv">PGPASSWORD</span><span class="o">=</span><span class="s2">"</span><span class="nv">$POSTGRES_PASSWORD</span><span class="s2">"</span><span class="w"> </span>psql<span class="w"> </span>--host<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>-U<span class="w"> </span>postgres<span class="w"> </span>-d<span class="w"> </span>postgres<span class="w"> </span>-p<span class="w"> </span><span class="m">54320</span>
</code></pre></div>
<ul>
<li>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  <div class="highlight"><pre><span></span><code><span class="nv">pg_username</span><span class="o">=</span>postgres
<span class="nv">pg_password</span><span class="o">=</span>&lt;POSTGRES_PASSWORD&gt;
<span class="nv">pg_uri</span><span class="o">=</span><span class="m">127</span>.0.0.1
<span class="nv">pg_port</span><span class="o">=</span><span class="m">5432</span>
<span class="nv">pg_original_db_name</span><span class="o">=</span><span class="s1">'postgres'</span>
</code></pre></div><blockquote>
<p>Note: after completing <a href="#create-databases">create databases</a> section below update   <code>pg_uri</code> in <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  </p><div class="highlight"><pre><span></span><code><span class="nv">pg_uri</span><span class="o">=</span>postgresql.&lt;OC_PROJECT&gt;.svc.cluster.local
</code></pre></div>
</blockquote>
</li>
</ul>
<h3 id="create-databases">Create databases</h3>
<blockquote>
<p>Once you have created the postgresql instance, you will need to gather the instance url, the port, the username, password and initial database, put these in the <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> file.</p>
</blockquote>
<p>To create the required databases and users, run the script:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>deployment-scripts/create_studio_dbs.py<span class="w"> </span>--env-path<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env
</code></pre></div>
<h2 id="5-authenticator-setup">5. Authenticator setup</h2>
<blockquote>
<p>Note:  Source latest environment variables using the command below..
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
</blockquote>
<p>We use OAuth2 authenticator for user authentication for the platform. This can be configured to use an external authenticator service, or could be deployed using the onboarded OpenShift authenticator or a service deployed on the cluster. At the moment our charts are configured to use IBM Security Verify <code>isv</code> and Keycloak <code>keycloak</code>.</p>
<h3 id="installing-and-setup">Installing and setup</h3>
<h4 id="1-ibm-security-verify">1. IBM Security Verify</h4>
<p>Visit https://docs.verify.ibm.com/verify</p>
<ul>
<li>Once you setup the authenticator, update <code>workspace/${DEPLOYMENT_ENV}/env/.env.sh</code> with...
  <div class="highlight"><pre><span></span><code><span class="c1"># AUTH</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OAUTH_TYPE</span><span class="o">=</span>isv<span class="w"> </span><span class="c1"># for IBM Security Verify</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OAUTH_CLIENT_ID</span><span class="o">=</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OAUTH_ISSUER_URL</span><span class="o">=</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OAUTH_URL</span><span class="o">=</span>
</code></pre></div></li>
</ul>
<p>Generate cookie secret as below
  </p><div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span>
</code></pre></div>
<ul>
<li>Also update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  <div class="highlight"><pre><span></span><code><span class="c1"># Oauth Credentials</span>
<span class="nv">oauth_client_secret</span><span class="o">=</span>
<span class="nv">oauth_cookie_secret</span><span class="o">=</span>
</code></pre></div></li>
</ul>
<h4 id="2-keycloak">2. Keycloak</h4>
<p>Deploy Keycloak for authentication:
</p><div class="highlight"><pre><span></span><code>python<span class="w"> </span>./deployment-scripts/update-keycloak-deployment.py<span class="w"> </span>--filename<span class="w"> </span>deployment-scripts/keycloak-deployment.yaml<span class="w"> </span>--env-path<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env<span class="w"> </span>&gt;<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/initialisation/keycloak-deployment.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/initialisation/keycloak-deployment.yaml<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span>
</code></pre></div>
<p>Wait for Keycloak to be ready:
</p><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready<span class="w"> </span>pod<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>keycloak<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>--timeout<span class="o">=</span>300s
</code></pre></div>
<h4 id="configure-keycloak-realm-and-client">Configure Keycloak Realm and Client</h4>
<p>You can follow the following commands to auto configure
</p><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">client_secret</span><span class="o">=</span><span class="sb">`</span>cat<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">'0-9a-zA-Z'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c32<span class="sb">`</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">cookie_secret</span><span class="o">=</span><span class="sb">`</span>cat<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">'0-9a-zA-Z'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c32<span class="sb">`</span>

./deployment-scripts/setup-keycloak.sh

sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/oauth_cookie_secret=.*/oauth_cookie_secret=</span><span class="nv">$cookie_secret</span><span class="s2">/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/.env

sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/export OAUTH_TYPE=.*/export OAUTH_TYPE=keycloak/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/export OAUTH_CLIENT_ID=.*/export OAUTH_CLIENT_ID=geostudio-client/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s|export OAUTH_ISSUER_URL=.*|export OAUTH_ISSUER_URL=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">"https://%s-%s.%s/realms/geostudio"</span><span class="w"> </span><span class="s2">"keycloak"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$OC_PROJECT</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CLUSTER_URL</span><span class="s2">"</span><span class="k">)</span><span class="s2">|g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s|export OAUTH_URL=.*|export OAUTH_URL=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">"https://%s-%s.%s/realms/geostudio/protocol/openid-connect/auth"</span><span class="w"> </span><span class="s2">"keycloak"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$OC_PROJECT</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CLUSTER_URL</span><span class="s2">"</span><span class="k">)</span><span class="s2">|g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/export OAUTH_PROXY_PORT=.*/export OAUTH_PROXY_PORT=</span><span class="si">${</span><span class="nv">OAUTH_PROXY_PORT</span><span class="si">}</span><span class="s2">/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
<p>Otherwise; if you have not run the above bash block you can follow the instructions below to create them manually through the Keycloak dashboard.</p>
<hr>
<ol>
<li><strong>Access Keycloak Admin Console</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Port forward to access Keycloak at http://localhost:8080</span>
kubectl<span class="w"> </span>port-forward<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>svc/keycloak<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span><span class="p">&amp;</span>
</code></pre></div></li>
<li>Open: http://localhost:8080</li>
<li>
<p>Login with username: <code>admin</code>, password: <code>admin</code></p>
</li>
<li>
<p><strong>Create Realm</strong>:</p>
</li>
<li>Click on "master" dropdown in top-left</li>
<li>Click "Create Realm"</li>
<li>Realm name: <code>geostudio</code></li>
<li>
<p>Click "Create"</p>
</li>
<li>
<p><strong>Create Client</strong>:</p>
</li>
<li>Go to "Clients"  "Create client"</li>
<li>Client ID: <code>geostudio-client</code></li>
<li>Client type: <code>OpenID Connect</code></li>
<li>Click "Next"</li>
<li>Client authentication: <code>ON</code></li>
<li>Authorization: <code>OFF</code></li>
<li>Authentication flow: Check all boxes (Standard flow, Direct access grants, etc.)</li>
<li>Valid redirect URIs: 
     <div class="highlight"><pre><span></span><code>https://geofm-ui.$OC_PROJECT.svc.cluster.local:4180/oauth2/callback
https://geofm-gateway.$OC_PROJECT.svc.cluster.local:4180/oauth2/callback
</code></pre></div></li>
<li>Web origins: <code>*</code></li>
<li>
<p>Click "Save"</p>
</li>
<li>
<p><strong>Get Client Secret</strong>:</p>
</li>
<li>Go to "Clients"  "geostudio-client"  "Credentials" tab</li>
<li>Copy the "Client secret" value</li>
<li>Generate cookie secret as below
     <div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>--<span class="w"> </span><span class="s1">'+/'</span><span class="w"> </span><span class="s1">'-_'</span>
</code></pre></div></li>
<li>
<p>Update your <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> file with this secrets</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Oauth Credentials</span>
<span class="nv">oauth_client_secret</span><span class="o">=</span>
<span class="nv">oauth_cookie_secret</span><span class="o">=</span>
</code></pre></div>
</li>
<li>
<p><strong>Create Test User</strong> (Optional):</p>
</li>
<li>Go to "Users"  "Create new user"</li>
<li>Username: <code>testuser</code></li>
<li>Email: <code>test@example.com</code></li>
<li>First name: <code>Test</code></li>
<li>Last name: <code>User</code></li>
<li>Click "Create"</li>
<li>Go to "Credentials" tab  "Set password"</li>
<li>Password: <code>testpass123</code></li>
<li>Temporary: <code>OFF</code></li>
<li>Click "Save"</li>
</ol>
<hr>
<p>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env.sh</code> with the following script</p>
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/export OAUTH_TYPE=.*/export OAUTH_TYPE=keycloak/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s/export OAUTH_CLIENT_ID=.*/export OAUTH_CLIENT_ID=geostudio-client/g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s|export OAUTH_ISSUER_URL=.*|export OAUTH_ISSUER_URL=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">"https://%s-%s.%s/realms/geostudio"</span><span class="w"> </span><span class="s2">"keycloak"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$OC_PROJECT</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CLUSTER_URL</span><span class="s2">"</span><span class="k">)</span><span class="s2">|g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s2">"s|export OAUTH_URL=.*|export OAUTH_URL=</span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">"https://%s-%s.%s/realms/geostudio/protocol/openid-connect/auth"</span><span class="w"> </span><span class="s2">"keycloak"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$OC_PROJECT</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CLUSTER_URL</span><span class="s2">"</span><span class="k">)</span><span class="s2">|g"</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
<p>Once you setup the authenticator (with either method), validate <code>workspace/${DEPLOYMENT_ENV}/env/.env.sh</code></p>
<h2 id="6-geoserver-setup">6. Geoserver setup</h2>
<p>To deploy Geoserver.  This will deploy geoserver, wait for the deployment to be completed and then start the required port-forwarding:
</p><div class="highlight"><pre><span></span><code>python<span class="w"> </span>./deployment-scripts/update-deployment-template.py<span class="w"> </span>--disable-pvc<span class="w"> </span>--filename<span class="w"> </span>deployment-scripts/geoserver-deployment.yaml<span class="w"> </span>--storageclass<span class="w"> </span><span class="si">${</span><span class="nv">NON_COS_STORAGE_CLASS</span><span class="si">}</span><span class="w"> </span>--proxy-base-url<span class="w"> </span><span class="k">$(</span><span class="nb">printf</span><span class="w"> </span><span class="s2">"https://%s-%s.%s/geoserver"</span><span class="w"> </span><span class="s2">"geofm-geoserver"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$OC_PROJECT</span><span class="s2">"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CLUSTER_URL</span><span class="s2">"</span><span class="k">)</span><span class="w"> </span>--geoserver-csrf-whitelist<span class="w"> </span><span class="si">${</span><span class="nv">CLUSTER_URL</span><span class="si">}</span><span class="w"> </span>&gt;<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/initialisation/geoserver-deployment.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/initialisation/geoserver-deployment.yaml<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span>

kubectl<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>ready<span class="w"> </span>pod<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>gfm-geoserver<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>--timeout<span class="o">=</span>900s

kubectl<span class="w"> </span>port-forward<span class="w"> </span>-n<span class="w"> </span><span class="si">${</span><span class="nv">OC_PROJECT</span><span class="si">}</span><span class="w"> </span>svc/geofm-geoserver<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>&gt;&gt;<span class="w"> </span>studio-pf.log<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">&amp;</span>
</code></pre></div>
<p>Once the deployment is complete and the port-forwarding is started, run the following script to setup the geoserver instance:
</p><div class="highlight"><pre><span></span><code>./deployment-scripts/setup_geoserver.sh
</code></pre></div>
<p>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with the Geoserver credentials.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Geoserver credentials</span>
<span class="nv">geoserver_username</span><span class="o">=</span>admin
<span class="nv">geoserver_password</span><span class="o">=</span>geoserver
</code></pre></div>
<h2 id="7-external-services-configuration">7. External services configuration</h2>
<blockquote>
<p>Note:  Source latest environment variables using the command below..
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
</blockquote>
<p>The services listed below are optional and when subscribed have a cost implication. They make the studio more user friendly and give access to extra datasources, but the studio can run end to end without them.</p>
<h4 id="1-mapbox">1. Mapbox</h4>
<p>Visit https://account.mapbox.com/ to access your account or create a new account. Follow these instructions to create access token https://docs.mapbox.com/help/dive-deeper/access-tokens/. It is recommended that for the token created, you use the <a href="https://docs.mapbox.com/help/dive-deeper/access-tokens/#url-restrictions">url restrictions</a> feature to secure your token and add the UI url which should be of the form 
</p><div class="highlight"><pre><span></span><code>https://geofm-ui-<span class="si">${</span><span class="nv">CLUSTER_URL</span><span class="si">}</span>
</code></pre></div>
<ul>
<li>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  <div class="highlight"><pre><span></span><code><span class="c1"># Mapbox credentials</span>
<span class="nv">mapbox_token</span><span class="o">=</span>
</code></pre></div></li>
</ul>
<h4 id="2-cesium">2. Cesium</h4>
<p>Visit https://ion.cesium.com/signin to access your account or create a new account and access token.
* Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  </p><div class="highlight"><pre><span></span><code><span class="c1"># Cesium credentials</span>
<span class="nv">cesium_token</span><span class="o">=</span>
</code></pre></div>
<h4 id="3-sentinel-hub">3. Sentinel Hub</h4>
<p>Visit https://www.sentinel-hub.com/ to access your account or create a new account and access token.
* Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...
  </p><div class="highlight"><pre><span></span><code><span class="c1"># Sentinelhub credentials</span>
<span class="nv">sh_client_id</span><span class="o">=</span>
<span class="nv">sh_client_secret</span><span class="o">=</span>
</code></pre></div>
<h4 id="4-nasa-earth-data">4. Nasa Earth Data</h4>
<p>Visit https://search.earthdata.nasa.gov/ to access your account or create a new account. Create access token.
* Update the token to <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with ...
  </p><div class="highlight"><pre><span></span><code><span class="c1"># Nasa Earth Data credentials</span>
<span class="nv">nasa_earth_data_bearer_token</span><span class="o">=</span>
</code></pre></div>
<h2 id="8-extra-configuration">8. Extra configuration</h2>
<p>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code></p>
<ul>
<li>To generate the studio_api_key run:
  <div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">STUDIO_API_KEY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"pak-</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">'a-zA-Z0-9'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">32</span><span class="k">)</span><span class="s2">"</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">API_ENCRYPTION_KEY</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">"</span><span class="k">$(</span>openssl<span class="w"> </span>rand<span class="w"> </span>-base64<span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">'+/'</span><span class="w"> </span><span class="s1">'-_'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span>-d<span class="w"> </span><span class="s1">'\n'</span><span class="k">)</span><span class="s2">"</span><span class="k">)</span>
</code></pre></div></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Studio api key</span>
<span class="nv">studio_api_key</span><span class="o">=</span><span class="nv">$STUDIO_API_KEY</span>

<span class="c1"># Studio api-key en</span>
<span class="nv">studio_api_encryption_key</span><span class="o">=</span><span class="nv">$API_ENCRYPTION_KEY</span>

<span class="c1"># Redis password</span>
<span class="nv">redis_password</span><span class="o">=</span>devPassword

<span class="c1"># imagePullSecret b64secret</span>
<span class="nv">image_pull_secret_b64</span><span class="o">=</span>
</code></pre></div>
<blockquote>
<p>Note: image_pull_secret_b64 to be provided if necessary</p>
</blockquote>
<p>Update <code>workspace/${DEPLOYMENT_ENV}/env/env.sh</code></p>
<p>Observability configuration for pipelines.
- Set true/false for OBSERVABILITY_ENABLED
</p><div class="highlight"><pre><span></span><code><span class="c1"># OBSERVABILITY</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OBSERVABILITY_ENABLED</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OBSERVABILITY_OTLP_ENDPOINT</span><span class="o">=</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OBSERVABILITY_OTLP_TRACES_ENDPOINT</span><span class="o">=</span>
</code></pre></div>
<p>GPU Configuration for pipelines.
- Set true/false for CONFIGURE_GPU_AFFINITY used by terratorch inference deployment
- Supply the selector key and the node gpu spec
</p><div class="highlight"><pre><span></span><code><span class="c1"># GPU_CONFIG</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CONFIGURE_GPU_AFFINITY</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_SELECTOR_KEY</span><span class="o">=</span>nvidia.com/gpu.product
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_GPU_SPEC</span><span class="o">=</span>NVIDIA-A100-SXM4-80GB
</code></pre></div>
<p>If not deploying to an Openshift cluster, update the following,</p>
<h1 id="environment-vars">Environment vars</h1>
<p>export ROUTE_ENABLED=false</p>
<p>For a kubernetes environment create a tls secret key and crt pair.
</p><div class="highlight"><pre><span></span><code><span class="c1"># create tls.key and tls.crt</span>

openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-nodes<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>tls.key<span class="w"> </span>-out<span class="w"> </span>tls.crt<span class="w"> </span>-subj<span class="w"> </span><span class="s2">"/CN=</span><span class="nv">$OC_PROJECT</span><span class="s2">.svc.cluster.local"</span>

<span class="c1"># extract the cert and key into env vars</span>

<span class="nb">export</span><span class="w"> </span><span class="nv">TLS_CRT_B64</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>base64<span class="w"> </span>-in<span class="w"> </span>tls.crt<span class="w"> </span>-A<span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TLS_KEY_B64</span><span class="o">=</span><span class="k">$(</span>openssl<span class="w"> </span>base64<span class="w"> </span>-in<span class="w"> </span>tls.key<span class="w"> </span>-A<span class="k">)</span>
</code></pre></div>
<p>Update <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> with...</p>
<div class="highlight"><pre><span></span><code><span class="nv">tls_crt_b64</span><span class="o">=</span><span class="nv">$TLS_CRT_B64</span>
<span class="nv">tls_key_b64</span><span class="o">=</span><span class="nv">$TLS_KEY_B64</span>
</code></pre></div>
<p>Update <code>workspace/${DEPLOYMENT_ENV}/env/env.sh</code> with...</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CREATE_TLS_SECRET</span><span class="o">=</span><span class="nb">true</span>
</code></pre></div>
<h2 id="9-deploy-geospatial-studio-services">9. Deploy Geospatial Studio services</h2>
<blockquote>
<p>Note:  Source latest environment variables using the command below..
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
</blockquote>
<p>At this point, review <code>workspace/${DEPLOYMENT_ENV}/env/.env</code> and <code>workspace/${DEPLOYMENT_ENV}/env/env.sh</code> to ensure that you have collected all the needed environment variables and secrets. To generate values.yaml for <code>studio</code> and <code>studio-pipelines charts</code>, run the command below.
</p><div class="highlight"><pre><span></span><code>./deployment-scripts/values-file-generate.sh
</code></pre></div>
This will generate two values files
* workspace/${DEPLOYMENT_ENV}/values/geospatial-studio/values.yaml
* workspace/${DEPLOYMENT_ENV}/values/geospatial-studio-pipelines/values.yaml
<p>It is recommended not to edit these values.yaml and instead create copies of them with names values-deploy.yaml.</p>
<p>To prepare for deployment, make a copy of the values.yaml file:</p>
<p>Copy for the studio
</p><div class="highlight"><pre><span></span><code>cp<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/values/geospatial-studio/values.yaml<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/values/geospatial-studio/values-deploy.yaml
</code></pre></div>
<p>Copy for the studio pipelines
</p><div class="highlight"><pre><span></span><code>cp<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/values/geospatial-studio-pipelines/values.yaml<span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/values/geospatial-studio-pipelines/values-deploy.yaml
</code></pre></div>
<p>Now review the <code>values-deploy.yaml</code> files above. Explanation of each can be found <a href="deployment-values-details.md">here</a>.  Once you have completed this you can use <code>helm</code> to deploy. If using OpenShift, ensure you are logged in to the cluster in the terminal (get the cli login link from the top right corner of the OpenShift dashboard, dropdown under your username). For Kubernetes, ensure the right context is set.</p>
<p>Once you are logged in, if this is the first time you are deploying the studio or have made changes to the charts, you need to pull dependecies for redis. Also in some instances you might need to delete <code>geospatial-studio/Chart.lock</code> file when there are conflicts.</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>dependency<span class="w"> </span>build<span class="w"> </span>./geospatial-studio/
</code></pre></div>
<p>To see the helm template you can run the following command,
</p><div class="highlight"><pre><span></span><code>helm<span class="w"> </span>template<span class="w"> </span>-f<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/values/geospatial-studio/values-deploy.yaml<span class="w"> </span>studio<span class="w"> </span>./geospatial-studio/<span class="w"> </span>--debug<span class="w"> </span>&gt;<span class="w"> </span>dryrun.yaml

helm<span class="w"> </span>template<span class="w"> </span>-f<span class="w"> </span>workspace/<span class="nv">$DEPLOYMENT_ENV</span>/values/geospatial-studio-pipelines/values-deploy.yaml<span class="w"> </span>studio<span class="w"> </span>./geospatial-studio-pipelines/<span class="w"> </span>--debug<span class="w"> </span>&gt;<span class="w"> </span>dryrun.yaml
</code></pre></div>
<p>Then proceed to deploy with studio with,</p>
<div class="highlight"><pre><span></span><code>./deployment-scripts/deploy_studio.sh
</code></pre></div>
<p>You can also deploy the pipelines with,
</p><div class="highlight"><pre><span></span><code>./deployment-scripts/deploy_pipelines.sh
</code></pre></div>
<p>To uninstall use
</p><div class="highlight"><pre><span></span><code>helm<span class="w"> </span>uninstall<span class="w"> </span>studio
helm<span class="w"> </span>uninstall<span class="w"> </span>studio-pipelines
</code></pre></div>
<p>To restart all pods, run
</p><div class="highlight"><pre><span></span><code>./deployment-scripts/restart-all-studio-pods.sh
</code></pre></div>
<h2 id="10-testing">10. Testing</h2>
<blockquote>
<p>Note:  Source latest environment variables using the command below..
</p><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>workspace/<span class="si">${</span><span class="nv">DEPLOYMENT_ENV</span><span class="si">}</span>/env/env.sh
</code></pre></div>
</blockquote>
<h3 id="generate-authentication-api-key">Generate authentication API Key</h3>
<p>Authentication to the Geospatial Studio is handled by a redirect in the UI, but for programmatic access (from the SDK, for example), the user will need to create an API key. This is can be easily done through the UI.</p>
<p>Run the command below to open the UI in your default browser;
</p><div class="highlight"><pre><span></span><code><span class="nv">ROUTE_URL</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>route<span class="w"> </span>geofm-ui<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{"https://"}{.spec.host}'</span><span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">"Opening </span><span class="nv">$ROUTE_URL</span><span class="s2">..."</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
<span class="o">(</span>open<span class="w"> </span><span class="nv">$ROUTE_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>xdg-open<span class="w"> </span><span class="nv">$ROUTE_URL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>start<span class="w"> </span><span class="nv">$ROUTE_URL</span><span class="o">)</span>
</code></pre></div>
<p>Authenticate the loaded UI in the browser and go to the Geospatial Studio UI page and navigate to the Manage your API keys link.</p>
<p>This should pop-up a window where you can generate, access and delete your api keys. NB: every user is limited to a maximum of two activate api keys at any one time. Copy your generated apikey to the bash command below and run it in terminal.</p>
<div class="highlight"><pre><span></span><code><span class="nv">MY_GEOSTUDIO_KEY</span><span class="o">=</span>
</code></pre></div>
<p>In your requests, you'll pass the key generated above in a header: <code>-H "X-API-Key: $MY_GEOSTUDIO_KEY"</code></p>
<h3 id="test-payload">Test Payload</h3>
<p>Use the default data provided under <code>/tests/api-data/*.json</code> as the payloads to hit the endpoints.</p>
<p><strong><em>Sample POST requests:</em></strong></p>
<ol>
<li>
<p>ADD a sandbox models resource</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">"</span><span class="nv">$ROUTE_URL</span><span class="s2">/studio-gateway/v2/models"</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s2">"X-API-Key: </span><span class="nv">$MY_GEOSTUDIO_KEY</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--data<span class="w"> </span>@tests/api-data/00-models.json
</code></pre></div>
</li>
<li>
<p>SUBMIT a test inference</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span><span class="s2">"</span><span class="nv">$ROUTE_URL</span><span class="s2">/studio-gateway/v2/inference"</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--header<span class="w"> </span><span class="s2">"X-API-Key: </span><span class="nv">$MY_GEOSTUDIO_KEY</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--data<span class="w"> </span>@tests/api-data/01-inferences.json
</code></pre></div>
<p>Check the UI, inference lab history to check the onboarded inference</p>
</li>
</ol></div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="February 3, 2026 13:37:34 UTC">February 3, 2026</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>