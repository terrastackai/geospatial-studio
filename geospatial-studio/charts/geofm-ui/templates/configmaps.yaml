# Â© Copyright IBM Corporation 2025
# SPDX-License-Identifier: Apache-2.0


{{ if .Values.global.oauth.oauthProxyEnabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    config.openshift.io/inject-trusted-cabundle: "true"
  name: {{ .Values.global.appNames.ui }}-trusted-certificates-ca
  namespace: {{ .Values.global.namespace }}
{{ end }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.global.appNames.ui }}-configmap
  namespace: {{ .Values.global.namespace }}
data:
  {{- /* Extra environment variables to be passed for the Values.extraEnvironment */ -}}
  {{- range $name, $value := .Values.extraEnvironment }}
  {{ $name }}: {{ quote $value }}
  {{- end }}
  {{- if eq .Values.global.environment "local" }}
  {{- if .Values.global.oauth.oauthProxyEnabled }}
  LOCAL_DEPLOYMENT: "true_with_ssl"
  {{- else }}
  LOCAL_DEPLOYMENT: "true"
  {{- end }}
  {{- end }}
  {{- if .Values.route.enabled }}
  MLFLOW_URL: {{ printf "%s-%s.%s" .Values.global.appNames.mlflow .Values.global.backends.namespace .Values.global.backends.cluster_url }}
  GEOFM_GEOSERVER: {{ printf "%s-%s.%s" .Values.global.appNames.geoserver .Values.global.backends.namespace .Values.global.backends.cluster_url }}
  STUDIO_GATEWAY_API_URL: {{ printf "%s-%s.%s" .Values.global.appNames.gateway .Values.global.backends.namespace .Values.global.backends.cluster_url }}
  {{- else }}
  MLFLOW_URL: {{ printf "%s.%s.svc.cluster.local:5000" .Values.global.appNames.mlflow .Values.global.backends.namespace }}
  GEOFM_GEOSERVER: {{ printf "%s.%s.svc.cluster.local:3000" .Values.global.appNames.geoserver .Values.global.backends.namespace }}
  {{- if .Values.global.oauth.oauthProxyEnabled }}
  STUDIO_GATEWAY_API_URL: {{ printf "%s.%s.svc.cluster.local:%s" .Values.global.appNames.gateway .Values.global.backends.namespace .Values.global.oauth.oauthProxyPort }}
  {{- else }}
  STUDIO_GATEWAY_API_URL: {{ printf "%s.%s.svc.cluster.local:8000" .Values.global.appNames.gateway .Values.global.backends.namespace }}
  {{- end }}
  {{- end }}
